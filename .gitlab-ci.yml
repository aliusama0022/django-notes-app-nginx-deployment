stages:
  - deploy

deploy:
  stage: deploy
  tags:
    - self-hosted   # The tag of your runner
  only:
    - main          # Run only on main branch
  before_script:
    - echo "ðŸ”„ Preparing environment..."
    - git fetch --all
    - git reset --hard origin/main
  script:
    - echo "ðŸš€ Deploying with Docker Compose..."
    - docker-compose down || true
    - docker-compose pull || true
    - docker-compose build --no-cache
    - docker-compose up -d
    - docker image prune -f
    - echo "âœ… Deployment complete!"
    - echo "ðŸ“¦ Current running containers:"
    - docker ps
