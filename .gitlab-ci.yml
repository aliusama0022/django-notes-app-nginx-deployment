deploy:
  stage: deploy
  tags:
    - self-hosted
  only:
    - main
  script:
    - echo "ðŸ”„ Preparing environment..."
    - git fetch --all
    - git reset --hard origin/main
    - echo "ðŸš€ Deploying with Docker Compose..."
    - sudo docker-compose down || true
    - sudo docker-compose pull || true
    - sudo docker-compose build --no-cache
    - sudo docker-compose up -d
    - sudo docker image prune -f
    - echo "âœ… Deployment complete!"
    - sudo docker ps
